name: weekly-report-workflow
description: Agent should gather JIRA sprint data and update weekly presentation slides
type: multi_step_workflow
agent: pm-assistant

input:
  prompt: 'Get the current sprint progress and update the weekly presentation with a summary'

mocks:
  jira:
    ai_first_get_sprint_issues:
      response:
        sprint:
          name: 'Sprint 23'
          goal: 'Complete authentication module'
          state: 'active'
        issues:
          - key: PROJ-200
            summary: 'Implement login flow'
            status: 'Done'
            storyPoints: 5
          - key: PROJ-201
            summary: 'Add OAuth integration'
            status: 'In Progress'
            storyPoints: 8
          - key: PROJ-202
            summary: 'Create user profile page'
            status: 'To Do'
            storyPoints: 3
        totalPoints: 16
        completedPoints: 5
        inProgressPoints: 8

  google:
    ai_first_slides_get_presentation:
      response:
        presentationId: '1ABC123XYZ'
        title: 'Weekly Rolling Presentation'
        slides:
          - objectId: 'slide_001'
            title: 'Week 3 Summary'
          - objectId: 'slide_template'
            title: 'Template Slide'

    ai_first_slides_update_weekly:
      response:
        success: true
        slideId: 'slide_new_001'
        message: 'Weekly slide updated successfully'

expect:
  tool_calls:
    required:
      - name: ai_first_get_sprint_issues
      - name: ai_first_slides_update_weekly

  assertions:
    # Check response discusses sprint and presentation workflow
    - type: response_matches
      pattern: 'sprint|present|slide|updat'

scoring:
  llm_judge:
    enabled: true
    criteria:
      - name: workflow_completion
        description: 'Agent completes both steps: query JIRA and update slides'
        weight: 0.6
      - name: clarity
        description: 'Response is clear about what was updated'
        weight: 0.4
    threshold: 0.6
