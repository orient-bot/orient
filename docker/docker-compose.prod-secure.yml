# =============================================================================
# Orient v0.2.0 - Production Security Hardening
# =============================================================================
# This file removes unnecessary port exposures in production.
# Only Nginx (80/443) should be externally accessible - all other services
# communicate via Docker's internal network.
#
# Usage:
#   docker compose -f docker-compose.v2.yml -f docker-compose.prod.yml \
#     -f docker-compose.r2.yml -f docker-compose.prod-secure.yml up -d
#
# v0.2.0 changes:
#   - Uses SQLite (no PostgreSQL service)
#   - WhatsApp integrated into dashboard service
#
# Security benefits:
#   - MinIO (9000, 9001) not exposed - prevents direct storage access
#   - Internal services route through Nginx reverse proxy only
#
# Accessing services for debugging:
#   - Database: Located at /app/data/orient.db inside dashboard container
#     docker exec -it orienter-dashboard sqlite3 /app/data/orient.db
#
# Rollback:
#   Remove this file from the compose stack to restore direct port access
# =============================================================================

services:
  # ===========================================================================
  # MinIO - Remove host port exposure
  # Access via Nginx proxy or docker exec only
  # ===========================================================================
  minio:
    ports: !reset []

  # ===========================================================================
  # OpenCode - Remove host port exposure
  # Routes through Nginx at /opencode/*
  # ===========================================================================
  opencode:
    ports: !reset []

  # ===========================================================================
  # Dashboard - Remove host port exposure
  # v0.2.0: WhatsApp is integrated into the dashboard service
  # Routes through Nginx at /dashboard/*
  # ===========================================================================
  dashboard:
    ports: !reset []

  # ===========================================================================
  # API Gateway - Remove host port exposure (optional service)
  # Routes through Nginx at /api/*
  # ===========================================================================
  api-gateway:
    ports: !reset []

  # ===========================================================================
  # Nginx - Keep as sole external gateway
  # This is the only service exposed to the host network
  # ===========================================================================
  nginx:
    ports:
      - '80:80'
      - '443:443'
