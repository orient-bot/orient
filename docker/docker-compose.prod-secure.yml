# =============================================================================
# Orient - Production Security Hardening
# =============================================================================
# This file removes unnecessary port exposures in production.
# Only Nginx (80/443) should be externally accessible - all other services
# communicate via Docker's internal network.
#
# Usage:
#   docker compose -f docker-compose.v2.yml -f docker-compose.prod.yml \
#     -f docker-compose.r2.yml -f docker-compose.prod-secure.yml up -d
#
# Security benefits:
#   - PostgreSQL (5432) not exposed to host - prevents direct DB access
#   - MinIO (9000, 9001) not exposed - prevents direct storage access
#   - Internal services route through Nginx reverse proxy only
#
# Accessing services for debugging:
#   - Database: ssh -L 5432:localhost:5432 user@server
#               then: psql -h localhost -U $POSTGRES_USER -d $POSTGRES_DB
#   - Or use: docker exec -it orienter-postgres psql -U $POSTGRES_USER -d $POSTGRES_DB
#
# Rollback:
#   Remove this file from the compose stack to restore direct port access
# =============================================================================

services:
  # ===========================================================================
  # PostgreSQL - Remove host port exposure
  # Access via SSH tunnel or docker exec only
  # ===========================================================================
  postgres:
    ports: !reset []

  # ===========================================================================
  # MinIO - Remove host port exposure
  # Access via Nginx proxy or docker exec only
  # ===========================================================================
  minio:
    ports: !reset []

  # ===========================================================================
  # OpenCode - Remove host port exposure
  # Routes through Nginx at /opencode/*
  # ===========================================================================
  opencode:
    ports: !reset []

  # ===========================================================================
  # Dashboard - Remove host port exposure
  # Note: In v0.2.0, WhatsApp is integrated into the dashboard service
  # Routes through Nginx at /dashboard/*
  # ===========================================================================
  dashboard:
    ports: !reset []

  # ===========================================================================
  # API Gateway - Remove host port exposure (optional service)
  # Routes through Nginx at /api/*
  # ===========================================================================
  api-gateway:
    ports: !reset []

  # ===========================================================================
  # Nginx - Keep as sole external gateway
  # This is the only service exposed to the host network
  # ===========================================================================
  nginx:
    ports:
      - '80:80'
      - '443:443'
